2025-11-19 15:09:26,271 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 188, in train_choice
    config = get_model_config(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\model_configs.py", line 48, in get_model_config
    "stratify": model_conf["stratify"],  # Estratificamos por el primer target
KeyError: 'stratify'
2025-11-19 15:10:32,998 [INFO] - Cargando diccionario ATC...
2025-11-19 15:10:33,002 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:10:33,002 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:10:33,006 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 126, in load_data
    df = pd.read_csv(str(csv_path_obj), sep="\t", index_col=False, usecols=self.cols_to_process, dtype=str)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\readers.py", line 1026, in read_csv
    return _read(filepath_or_buffer, kwds)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\readers.py", line 620, in _read
    parser = TextFileReader(filepath_or_buffer, **kwds)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\readers.py", line 1620, in __init__
    self._engine = self._make_engine(f, self.engine)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\readers.py", line 1898, in _make_engine
    return mapping[engine](f, **self.options)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\c_parser_wrapper.py", line 140, in __init__
    self._validate_usecols_names(usecols, self.orig_names)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\base_parser.py", line 988, in _validate_usecols_names
    raise ValueError(
ValueError: Usecols do not match columns, columns expected but not found: ['allele', 'effect_type', 'effect_direction', 'genalle', 'phenotype_outcome', 'drug', 'gene', 'atc']

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 114, in train_pipeline
    df = data_loader_obj.load_data(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 128, in load_data
    raise KeyError(f"Error al leer el archivo CSV/TSV. Verifica las columnas requeridas: {self.cols_to_process}") from e
KeyError: "Error al leer el archivo CSV/TSV. Verifica las columnas requeridas: ['atc', 'drug', 'genalle', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type']"
2025-11-19 15:12:58,913 [INFO] - Cargando diccionario ATC...
2025-11-19 15:12:58,917 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:12:58,917 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:12:58,968 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 15:12:59,043 [INFO] - Nombres de entidades limpiados.
2025-11-19 15:12:59,046 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 114, in train_pipeline
    df = data_loader_obj.load_data(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 167, in load_data
    df["stratify_col"] = df[stratify_cols].agg("_".join, axis=1)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\frame.py", line 4119, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 6212, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 6261, in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
KeyError: "None of [Index(['Phenotype_outcome'], dtype='object')] are in the [columns]"
2025-11-19 15:14:35,164 [INFO] - Cargando diccionario ATC...
2025-11-19 15:14:35,168 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:14:35,168 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:14:35,217 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 15:14:35,289 [INFO] - Nombres de entidades limpiados.
2025-11-19 15:14:35,291 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 114, in train_pipeline
    df = data_loader_obj.load_data(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 167, in load_data
    df["stratify_col"] = df[stratify_cols].agg("_".join, axis=1)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\frame.py", line 4119, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 6212, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 6261, in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
KeyError: "None of [Index(['Phenotype_outcome'], dtype='object')] are in the [columns]"
2025-11-19 15:16:30,697 [INFO] - Cargando diccionario ATC...
2025-11-19 15:16:30,701 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:16:30,702 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:16:30,751 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 15:16:30,823 [INFO] - Nombres de entidades limpiados.
2025-11-19 15:16:30,870 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 15:16:30,870 [INFO] - Semilla utilizada: 711
2025-11-19 15:16:30,877 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 15:16:30,878 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 15:16:30,878 [INFO] - Columna 'atc' será manejada por ATCProcessor.
2025-11-19 15:16:30,888 [INFO] - Encoders ajustados correctamente.
2025-11-19 15:16:30,888 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:16:30,955 [INFO] - Transformación completada para 10524 filas.
2025-11-19 15:16:30,956 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:16:31,013 [INFO] - Transformación completada para 2632 filas.
2025-11-19 15:16:31,014 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 15:16:31,014 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 15:16:31,015 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 218, in _na_arithmetic_op
    result = func(left, right)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\computation\expressions.py", line 242, in evaluate
    return _evaluate(op, op_str, a, b)  # type: ignore[misc]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\computation\expressions.py", line 73, in _evaluate_standard
    return op(a, b)
TypeError: unsupported operand type(s) for -: 'str' and 'set'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 150, in train_pipeline
    train_dataset = PGenDataset(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 318, in __init__
    relevant_cols = df.columns - set(df['stratify_col'])
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\common.py", line 76, in new_method
    return method(self, other)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\arraylike.py", line 194, in __sub__
    return self._arith_method(other, operator.sub)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 7304, in _arith_method
    return super()._arith_method(other, op)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\base.py", line 1391, in _arith_method
    result = ops.arithmetic_op(lvalues, rvalues, op)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 283, in arithmetic_op
    res_values = _na_arithmetic_op(left, right, op)  # type: ignore[arg-type]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 227, in _na_arithmetic_op
    result = _masked_arith_op(left, right, op)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 167, in _masked_arith_op
    raise TypeError(
TypeError: Cannot broadcast np.ndarray with operand of type <class 'set'>
2025-11-19 15:22:28,256 [INFO] - Cargando diccionario ATC...
2025-11-19 15:22:28,261 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:22:28,261 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:22:28,345 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 15:22:28,420 [INFO] - Nombres de entidades limpiados.
2025-11-19 15:22:28,466 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 15:22:28,466 [INFO] - Semilla utilizada: 711
2025-11-19 15:22:28,472 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 15:22:28,473 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 15:22:28,473 [INFO] - Columna 'atc' será manejada por ATCProcessor.
2025-11-19 15:22:28,482 [INFO] - Encoders ajustados correctamente.
2025-11-19 15:22:28,482 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:22:28,544 [INFO] - Transformación completada para 10524 filas.
2025-11-19 15:22:28,544 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:22:28,601 [INFO] - Transformación completada para 2632 filas.
2025-11-19 15:22:28,601 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 15:22:28,601 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 15:22:28,602 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 218, in _na_arithmetic_op
    result = func(left, right)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\computation\expressions.py", line 242, in evaluate
    return _evaluate(op, op_str, a, b)  # type: ignore[misc]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\computation\expressions.py", line 73, in _evaluate_standard
    return op(a, b)
TypeError: unsupported operand type(s) for -: 'str' and 'set'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 151, in train_pipeline
    train_dataset = PGenDataset(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 318, in __init__
    relevant_cols = df.columns - set(df['stratify_col'])
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\common.py", line 76, in new_method
    return method(self, other)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\arraylike.py", line 194, in __sub__
    return self._arith_method(other, operator.sub)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 7304, in _arith_method
    return super()._arith_method(other, op)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\base.py", line 1391, in _arith_method
    result = ops.arithmetic_op(lvalues, rvalues, op)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 283, in arithmetic_op
    res_values = _na_arithmetic_op(left, right, op)  # type: ignore[arg-type]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 227, in _na_arithmetic_op
    result = _masked_arith_op(left, right, op)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 167, in _masked_arith_op
    raise TypeError(
TypeError: Cannot broadcast np.ndarray with operand of type <class 'set'>
2025-11-19 15:23:59,299 [INFO] - Cargando diccionario ATC...
2025-11-19 15:23:59,303 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:23:59,303 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:23:59,381 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 15:23:59,454 [INFO] - Nombres de entidades limpiados.
2025-11-19 15:23:59,500 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 15:23:59,501 [INFO] - Semilla utilizada: 711
2025-11-19 15:23:59,507 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 15:23:59,508 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 15:23:59,508 [INFO] - Columna 'atc' será manejada por ATCProcessor.
2025-11-19 15:23:59,517 [INFO] - Encoders ajustados correctamente.
2025-11-19 15:23:59,518 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:23:59,581 [INFO] - Transformación completada para 10524 filas.
2025-11-19 15:23:59,581 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:23:59,640 [INFO] - Transformación completada para 2632 filas.
2025-11-19 15:23:59,640 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 15:23:59,640 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 15:23:59,641 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 151, in train_pipeline
    train_dataset = PGenDataset(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 318, in __init__
    relevant_cols = df.columns.difference([df['stratify_col']])
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3668, in difference
    result = self._difference(other, sort=sort)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3676, in _difference
    other = other.unique()
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3072, in unique
    if self.is_unique:
  File "pandas/_libs/properties.pyx", line 36, in pandas._libs.properties.CachedProperty.__get__
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 2353, in is_unique
    return self._engine.is_unique
  File "pandas/_libs/index.pyx", line 266, in pandas._libs.index.IndexEngine.is_unique.__get__
  File "pandas/_libs/index.pyx", line 271, in pandas._libs.index.IndexEngine._do_unique_check
  File "pandas/_libs/index.pyx", line 333, in pandas._libs.index.IndexEngine._ensure_mapping_populated
  File "pandas/_libs/hashtable_class_helper.pxi", line 7122, in pandas._libs.hashtable.PyObjectHashTable.map_locations
TypeError: unhashable type: 'Series'
2025-11-19 15:39:32,945 [INFO] - Cargando diccionario ATC...
2025-11-19 15:39:32,955 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:39:32,955 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:39:33,037 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 15:39:33,109 [INFO] - Nombres de entidades limpiados.
2025-11-19 15:39:33,154 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 15:39:33,154 [INFO] - Semilla utilizada: 711
2025-11-19 15:39:33,161 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 15:39:33,161 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 15:39:33,161 [INFO] - Columna 'atc' será manejada por ATCProcessor.
2025-11-19 15:39:33,170 [INFO] - Encoders ajustados correctamente.
2025-11-19 15:39:33,170 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:39:33,230 [INFO] - Transformación completada para 10524 filas.
2025-11-19 15:39:33,230 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:39:33,286 [INFO] - Transformación completada para 2632 filas.
2025-11-19 15:39:33,286 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 15:39:33,287 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 15:39:33,301 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 192, in train_pipeline
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 192, in <listcomp>
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
KeyError: 'atc'
2025-11-19 15:42:45,371 [INFO] - Cargando diccionario ATC...
2025-11-19 15:42:45,375 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:42:45,375 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:42:45,457 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 15:42:45,531 [INFO] - Nombres de entidades limpiados.
2025-11-19 15:42:45,577 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 15:42:45,577 [INFO] - Semilla utilizada: 711
2025-11-19 15:42:45,583 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 15:42:45,583 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 15:42:45,583 [INFO] - Columna 'atc' será manejada por ATCProcessor.
2025-11-19 15:42:45,593 [INFO] - Encoders ajustados correctamente.
2025-11-19 15:42:45,593 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:42:45,656 [INFO] - Transformación completada para 10524 filas.
2025-11-19 15:42:45,657 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:42:45,715 [INFO] - Transformación completada para 2632 filas.
2025-11-19 15:42:45,715 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 15:42:45,715 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 15:42:45,725 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 192, in train_pipeline
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 192, in <listcomp>
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
KeyError: 'ATC'
2025-11-19 15:52:07,126 [INFO] - Cargando diccionario ATC...
2025-11-19 15:52:07,130 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:52:07,130 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:52:07,210 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 15:52:07,271 [INFO] - Nombres de entidades limpiados.
2025-11-19 15:52:07,315 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 15:52:07,316 [INFO] - Semilla utilizada: 711
2025-11-19 15:52:07,322 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 15:52:07,322 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 15:52:07,322 [INFO] - Columna 'atc' será manejada por ATCProcessor.
2025-11-19 15:52:07,331 [INFO] - Encoders ajustados correctamente.
2025-11-19 15:52:07,331 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:52:07,385 [INFO] - Transformación completada para 10524 filas.
2025-11-19 15:52:07,385 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:52:07,439 [INFO] - Transformación completada para 2632 filas.
2025-11-19 15:52:07,439 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 15:52:07,440 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 15:52:07,450 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 192, in train_pipeline
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in feature_cols]
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 192, in <listcomp>
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in feature_cols]
KeyError: 'atc'
2025-11-19 15:58:53,633 [INFO] - Cargando diccionario ATC...
2025-11-19 15:58:53,638 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 15:58:53,638 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 15:58:53,717 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 15:58:53,777 [INFO] - Nombres de entidades limpiados.
2025-11-19 15:58:53,820 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 15:58:53,820 [INFO] - Semilla utilizada: 711
2025-11-19 15:58:53,827 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 15:58:53,827 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 15:58:53,827 [INFO] - Columna 'atc' será manejada por ATCProcessor.
2025-11-19 15:58:53,836 [INFO] - Encoders ajustados correctamente.
2025-11-19 15:58:53,836 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:58:53,890 [INFO] - Transformación completada para 10524 filas.
2025-11-19 15:58:53,891 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 15:58:53,948 [INFO] - Transformación completada para 2632 filas.
2025-11-19 15:58:53,948 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 15:58:53,948 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 15:58:53,976 [INFO] - Inicializando 'atc' con ATCHierarchicalEmbedding
2025-11-19 15:58:53,999 [INFO] - DeepFM_PGenModel initialized with 1 output heads
2025-11-19 15:58:55,148 [INFO] - Model moved to device: cuda
2025-11-19 15:58:55,148 [INFO] - Mixed precision training (AMP) enabled for faster GPU computation
2025-11-19 15:58:57,647 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 261, in train_pipeline
    best_loss, best_accuracy_list, avg_per_task_losses = train_model( # type: ignore
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\train.py", line 247, in train_model
    outputs = model(**features)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
TypeError: DeepFM_PGenModel.forward() got an unexpected keyword argument 'atc'
2025-11-19 16:02:22,452 [INFO] - Cargando diccionario ATC...
2025-11-19 16:02:22,457 [INFO] - ATC Processor inicializado. Vocab sizes: {1: 15, 2: 94, 3: 255, 4: 772, 5: 3120}
2025-11-19 16:02:22,457 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 16:02:22,536 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 16:02:22,597 [INFO] - Nombres de entidades limpiados.
2025-11-19 16:02:22,642 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 16:02:22,642 [INFO] - Semilla utilizada: 711
2025-11-19 16:02:22,648 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 16:02:22,648 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 16:02:22,649 [INFO] - Columna 'atc' será manejada por ATCProcessor.
2025-11-19 16:02:22,657 [INFO] - Encoders ajustados correctamente.
2025-11-19 16:02:22,657 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 16:02:22,712 [INFO] - Transformación completada para 10524 filas.
2025-11-19 16:02:22,712 [INFO] - Codificando columna ATC 'atc'...
2025-11-19 16:02:22,768 [INFO] - Transformación completada para 2632 filas.
2025-11-19 16:02:22,769 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 16:02:22,769 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 16:02:22,795 [INFO] - Inicializando 'atc' con ATCHierarchicalEmbedding
2025-11-19 16:02:22,818 [INFO] - DeepFM_PGenModel initialized with 1 output heads
2025-11-19 16:02:23,636 [INFO] - Model moved to device: cuda
2025-11-19 16:02:23,636 [INFO] - Mixed precision training (AMP) enabled for faster GPU computation
2025-11-19 16:02:26,248 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 379, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 376, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 174, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 204, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 261, in train_pipeline
    best_loss, best_accuracy_list, avg_per_task_losses = train_model( # type: ignore
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\train.py", line 247, in train_model
    outputs = model(features)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\model.py", line 801, in forward
    deep_x = layer(deep_x)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (512x960 and 1920x1024)
2025-11-19 17:20:32,165 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 192, in train_choice
    config = get_model_config(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\model_configs.py", line 48, in get_model_config
    "stratify": str(model_conf["stratify"]),  # Estratificamos por el primer target
KeyError: 'stratify'
2025-11-19 17:21:27,481 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 17:21:27,528 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 17:21:27,592 [INFO] - Nombres de entidades limpiados.
2025-11-19 17:21:27,593 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: "['Phenotype_outcome']"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 99, in train_pipeline
    df = data_loader_obj.load_data(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 141, in load_data
    df["stratify_col"] = df[stratify_cols].agg("_".join, axis=1)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: "['Phenotype_outcome']"
2025-11-19 17:22:20,302 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 17:22:20,349 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 17:22:20,413 [INFO] - Nombres de entidades limpiados.
2025-11-19 17:22:20,414 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 99, in train_pipeline
    df = data_loader_obj.load_data(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 141, in load_data
    df["stratify_col"] = df[stratify_cols].agg("_".join, axis=1)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\frame.py", line 4119, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 6212, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 6261, in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
KeyError: "None of [Index(['Phenotype_outcome'], dtype='object')] are in the [columns]"
2025-11-19 17:25:26,141 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 17:25:26,189 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 17:25:26,252 [INFO] - Nombres de entidades limpiados.
2025-11-19 17:25:26,254 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Phenotype_outcome'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 99, in train_pipeline
    df = data_loader_obj.load_data(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 144, in load_data
    df["stratify_col"] = df[stratify_cols[0]] if isinstance(stratify_cols, list) else df[stratify_cols]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'Phenotype_outcome'
2025-11-19 17:26:38,788 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 17:26:38,839 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 17:26:38,903 [INFO] - Nombres de entidades limpiados.
2025-11-19 17:26:38,920 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 17:26:38,920 [INFO] - Semilla utilizada: 711
2025-11-19 17:26:38,926 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 17:26:38,926 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 17:26:38,936 [INFO] - Encoders ajustados correctamente.
2025-11-19 17:26:38,986 [INFO] - Transformación completada para 10524 filas.
2025-11-19 17:26:39,007 [INFO] - Transformación completada para 2632 filas.
2025-11-19 17:26:39,007 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 17:26:39,007 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 17:26:39,007 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 218, in _na_arithmetic_op
    result = func(left, right)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\computation\expressions.py", line 242, in evaluate
    return _evaluate(op, op_str, a, b)  # type: ignore[misc]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\computation\expressions.py", line 73, in _evaluate_standard
    return op(a, b)
TypeError: unsupported operand type(s) for -: 'str' and 'set'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 135, in train_pipeline
    train_dataset = PGenDataset(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 283, in __init__
    relevant_cols = df.columns - set(df['stratify_col'])
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\common.py", line 76, in new_method
    return method(self, other)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\arraylike.py", line 194, in __sub__
    return self._arith_method(other, operator.sub)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 7304, in _arith_method
    return super()._arith_method(other, op)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\base.py", line 1391, in _arith_method
    result = ops.arithmetic_op(lvalues, rvalues, op)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 283, in arithmetic_op
    res_values = _na_arithmetic_op(left, right, op)  # type: ignore[arg-type]
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 227, in _na_arithmetic_op
    result = _masked_arith_op(left, right, op)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\ops\array_ops.py", line 167, in _masked_arith_op
    raise TypeError(
TypeError: Cannot broadcast np.ndarray with operand of type <class 'set'>
2025-11-19 17:29:05,483 [INFO] - Cargando datos desde: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv
2025-11-19 17:29:05,534 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 17:29:05,599 [INFO] - Nombres de entidades limpiados.
2025-11-19 17:29:05,616 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 17:29:05,616 [INFO] - Semilla utilizada: 711
2025-11-19 17:29:05,623 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 17:29:05,623 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 17:29:05,633 [INFO] - Encoders ajustados correctamente.
2025-11-19 17:29:05,684 [INFO] - Transformación completada para 10524 filas.
2025-11-19 17:29:05,705 [INFO] - Transformación completada para 2632 filas.
2025-11-19 17:29:05,705 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 17:29:05,705 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 17:29:05,712 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 176, in train_pipeline
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 176, in <listcomp>
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
KeyError: 'atc'
2025-11-19 17:57:32,873 [INFO] - Archivo detectado con extensión '.tsv': usando separador '	'
2025-11-19 17:57:32,873 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 17:57:32,923 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 17:57:32,982 [INFO] - Nombres de entidades limpiados.
2025-11-19 17:57:33,013 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 17:57:33,016 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 17:57:33,016 [INFO] - Semilla utilizada: 711
2025-11-19 17:57:33,021 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 17:57:33,022 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 126, in train_pipeline
    data_loader_obj.fit(train_df)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 145, in fit
    raise ValueError(f"A df_train le faltan las columnas: {missing_cols}")
ValueError: A df_train le faltan las columnas: {'effect_direction', 'drug', 'allele', 'effect_type', 'gene', 'phenotype_outcome', 'genalle'}
2025-11-19 17:59:07,767 [INFO] - Archivo detectado con extensión '.tsv': usando separador '	'
2025-11-19 17:59:07,767 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 17:59:07,818 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 17:59:07,875 [INFO] - Nombres de entidades limpiados.
2025-11-19 17:59:07,906 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 17:59:07,908 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 17:59:07,908 [INFO] - Semilla utilizada: 711
2025-11-19 17:59:07,914 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 17:59:07,914 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 126, in train_pipeline
    data_loader_obj.fit(train_df)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 145, in fit
    raise ValueError(f"A df_train le faltan las columnas: {missing_cols}")
ValueError: A df_train le faltan las columnas: {'effect_direction', 'gene', 'drug', 'allele', 'phenotype_outcome', 'effect_type', 'genalle'}
2025-11-19 18:02:58,720 [INFO] - Archivo detectado con extensión '.tsv': usando separador '	'
2025-11-19 18:02:58,720 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 18:02:58,767 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 18:02:58,826 [INFO] - Nombres de entidades limpiados.
2025-11-19 18:02:58,855 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 18:02:58,858 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 18:02:58,858 [INFO] - Semilla utilizada: 711
2025-11-19 18:02:58,864 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 18:02:58,864 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 18:02:58,864 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'drug'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 126, in train_pipeline
    data_loader_obj.fit(train_df)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 161, in fit
    unique_labels = df_train[col].astype(str).unique().tolist()
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'drug'
2025-11-19 18:12:18,302 [INFO] - Archivo detectado con extensión '.tsv': usando separador '	'
2025-11-19 18:12:18,302 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 18:12:18,352 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 18:12:18,410 [INFO] - Nombres de entidades limpiados.
2025-11-19 18:12:18,442 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 18:12:18,445 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 18:12:18,445 [INFO] - Semilla utilizada: 711
2025-11-19 18:12:18,450 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 18:12:18,451 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 126, in train_pipeline
    data_loader_obj.fit(train_df)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 140, in fit
    raise ValueError(f"A df_train le faltan las columnas: {missing_cols}")
ValueError: A df_train le faltan las columnas: {'genalle', 'effect_type', 'phenotype_outcome', 'drug', 'gene', 'allele', 'effect_direction'}
2025-11-19 18:16:52,490 [INFO] - Archivo detectado con extensión '.tsv': usando separador '	'
2025-11-19 18:16:52,490 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 18:16:52,539 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 18:16:52,596 [INFO] - Nombres de entidades limpiados.
2025-11-19 18:16:52,627 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 18:16:52,629 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 18:16:52,629 [INFO] - Semilla utilizada: 711
2025-11-19 18:16:52,635 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 18:16:52,636 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 126, in train_pipeline
    data_loader_obj.fit(train_df)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 145, in fit
    raise ValueError(f"A df_train le faltan las columnas: {missing_cols}")
ValueError: A df_train le faltan las columnas: {'genalle', 'effect_direction', 'gene', 'drug', 'effect_type', 'allele', 'phenotype_outcome'}
2025-11-19 18:18:15,961 [INFO] - Archivo detectado con extensión '.tsv': usando separador '	'
2025-11-19 18:18:15,961 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 18:18:16,011 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 18:18:16,069 [INFO] - Nombres de entidades limpiados.
2025-11-19 18:18:16,099 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 18:18:16,102 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 18:18:16,102 [INFO] - Semilla utilizada: 711
2025-11-19 18:18:16,108 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 18:18:16,108 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 126, in train_pipeline
    data_loader_obj.fit(train_df)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 145, in fit
    raise ValueError(f"A df_train le faltan las columnas: {missing_cols}")
ValueError: A df_train le faltan las columnas: {'allele', 'genalle', 'effect_type', 'gene', 'drug', 'effect_direction', 'phenotype_outcome'}
2025-11-19 18:19:59,634 [INFO] - Archivo detectado con extensión '.tsv': usando separador '	'
2025-11-19 18:19:59,634 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 18:19:59,683 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 18:19:59,741 [INFO] - Nombres de entidades limpiados.
2025-11-19 18:19:59,771 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 18:19:59,774 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 18:19:59,774 [INFO] - Semilla utilizada: 711
2025-11-19 18:19:59,780 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 18:19:59,780 [INFO] - 
2025-11-19 18:19:59,780 [INFO] - 
Columnas requeridas para fit: ['drug', 'genalle', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type']
2025-11-19 18:19:59,780 [INFO] - 
Columnas faltantes: {'drug', 'allele', 'effect_direction', 'gene', 'phenotype_outcome', 'effect_type', 'genalle'}
2025-11-19 18:19:59,780 [INFO] - ['Drug', 'Gene', 'Allele', 'Phenotype_outcome', 'Effect_direction', 'Effect_type', 'Genalle', 'stratify_col']
2025-11-19 18:19:59,780 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 126, in train_pipeline
    data_loader_obj.fit(train_df)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 145, in fit
    raise ValueError(f"A df_train le faltan las columnas: {missing_cols}")
ValueError: A df_train le faltan las columnas: {'drug', 'allele', 'effect_direction', 'gene', 'phenotype_outcome', 'effect_type', 'genalle'}
2025-11-19 18:50:34,459 [INFO] - Archivo detectado con extensión '.tsv': usando separador '	'
2025-11-19 18:50:34,459 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 18:50:34,508 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 18:50:34,566 [INFO] - Nombres de entidades limpiados.
2025-11-19 18:50:34,596 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 18:50:34,611 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 18:50:34,611 [INFO] - Semilla utilizada: 711
2025-11-19 18:50:34,617 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 18:50:34,618 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 18:50:34,627 [INFO] - Encoders ajustados correctamente.
2025-11-19 18:50:34,674 [INFO] - Transformación completada para 10524 filas.
2025-11-19 18:50:34,695 [INFO] - Transformación completada para 2632 filas.
2025-11-19 18:50:34,695 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 18:50:34,695 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 18:50:34,702 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 176, in train_pipeline
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 176, in <listcomp>
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
KeyError: 'atc'
2025-11-19 18:57:03,452 [INFO] - Archivo detectado con extensión '.tsv': usando separador '	'
2025-11-19 18:57:03,452 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 18:57:03,455 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 101, in train_pipeline
    df = data_loader_obj.load_data(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 93, in load_data
    df = data_import_normalize(csv_path_obj=csv_path_obj,
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data_utils.py", line 129, in data_import_normalize
    df = pd.read_csv(csv_path_obj, sep=ext_file, usecols=cols_to_use, dtype=str)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\readers.py", line 1026, in read_csv
    return _read(filepath_or_buffer, kwds)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\readers.py", line 620, in _read
    parser = TextFileReader(filepath_or_buffer, **kwds)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\readers.py", line 1620, in __init__
    self._engine = self._make_engine(f, self.engine)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\readers.py", line 1898, in _make_engine
    return mapping[engine](f, **self.options)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\c_parser_wrapper.py", line 140, in __init__
    self._validate_usecols_names(usecols, self.orig_names)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\io\parsers\base_parser.py", line 988, in _validate_usecols_names
    raise ValueError(
ValueError: Usecols do not match columns, columns expected but not found: ['allele', 'atc', 'gene', 'phenotype_outcome', 'genalle']
2025-11-19 19:10:55,354 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 19:10:55,403 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'stratify_col'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 102, in train_pipeline
    df = data_loader_obj.load_data(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 112, in load_data
    counts = df["stratify_col"].value_counts()
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\frame.py", line 4113, in __getitem__
    indexer = self.columns.get_loc(key)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'stratify_col'
2025-11-19 19:12:12,320 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 19:12:12,367 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 19:12:12,425 [INFO] - Nombres de entidades limpiados.
2025-11-19 19:12:12,455 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 19:12:12,470 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 19:12:12,470 [INFO] - Columnas del DF: ['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col']
2025-11-19 19:12:12,470 [INFO] - Semilla utilizada: 711
2025-11-19 19:12:12,477 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 19:12:12,477 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 19:12:12,487 [INFO] - Encoders ajustados correctamente.
2025-11-19 19:12:12,533 [INFO] - Transformación completada para 10524 filas.
2025-11-19 19:12:12,553 [INFO] - Transformación completada para 2632 filas.
2025-11-19 19:12:12,553 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 19:12:12,553 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 19:12:12,561 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 182, in train_pipeline
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 182, in <listcomp>
    n_features_list = [len(data_loader_obj.encoders[f].classes_) for f in inputs_from_config]
KeyError: 'atc'
2025-11-19 19:20:05,846 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 19:20:05,894 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 19:20:05,953 [INFO] - Nombres de entidades limpiados.
2025-11-19 19:20:05,983 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 19:20:06,834 [INFO] - 
Tokens sin asignar: 258

2025-11-19 19:20:06,871 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 19:20:06,871 [INFO] - Columnas del DF: ['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:20:06,871 [INFO] - Semilla utilizada: 711
2025-11-19 19:20:06,872 [INFO] - Mapeando nombres de fármacos a códigos ATC...
2025-11-19 19:20:06,872 [INFO] - COLUMNAS DEL DF:['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:20:06,878 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 19:20:06,879 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 19:20:06,888 [INFO] - Encoders ajustados correctamente.
2025-11-19 19:20:06,936 [INFO] - Transformación completada para 10524 filas.
2025-11-19 19:20:06,956 [INFO] - Transformación completada para 2632 filas.
2025-11-19 19:20:06,956 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 19:20:06,956 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 19:20:06,963 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 268, in __init__
    self.tensors[col] = torch.from_numpy(col_values).long()
TypeError: can't convert np.ndarray of type numpy.object_. The only supported types are: float64, float32, float16, complex64, complex128, int64, int32, int16, int8, uint64, uint32, uint16, uint8, and bool.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 145, in train_pipeline
    train_dataset = PGenDataset(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 270, in __init__
    raise TypeError(
TypeError: Error al crear tensor para la columna 'atc'. Verifica que no contenga tipos mixtos.
2025-11-19 19:24:04,075 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 19:24:04,123 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 19:24:04,182 [INFO] - Nombres de entidades limpiados.
2025-11-19 19:24:04,213 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 19:24:05,070 [INFO] - 
Tokens sin asignar: 258

2025-11-19 19:24:05,105 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 19:24:05,105 [INFO] - Columnas del DF: ['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:24:05,105 [INFO] - Semilla utilizada: 711
2025-11-19 19:24:05,105 [INFO] - Mapeando nombres de fármacos a códigos ATC...
2025-11-19 19:24:05,105 [INFO] - COLUMNAS DEL DF:['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:24:05,112 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 19:24:05,112 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 19:24:05,122 [INFO] - Encoders ajustados correctamente.
2025-11-19 19:24:05,169 [INFO] - Transformación completada para 10524 filas.
2025-11-19 19:24:05,190 [INFO] - Transformación completada para 2632 filas.
2025-11-19 19:24:05,190 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 19:24:05,190 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 19:24:05,196 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 268, in __init__
    self.tensors[col] = torch.from_numpy(col_values).long()
TypeError: can't convert np.ndarray of type numpy.object_. The only supported types are: float64, float32, float16, complex64, complex128, int64, int32, int16, int8, uint64, uint32, uint16, uint8, and bool.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 154, in train_pipeline
    train_dataset = PGenDataset(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 270, in __init__
    raise TypeError(
TypeError: Error al crear tensor para la columna 'atc'. Verifica que no contenga tipos mixtos.
2025-11-19 19:25:26,286 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 19:25:26,335 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 19:25:26,394 [INFO] - Nombres de entidades limpiados.
2025-11-19 19:25:26,425 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 19:25:27,275 [INFO] - 
Tokens sin asignar: 258

2025-11-19 19:25:27,310 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 19:25:27,310 [INFO] - Columnas del DF: ['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:25:27,310 [INFO] - Semilla utilizada: 711
2025-11-19 19:25:27,310 [INFO] - Mapeando nombres de fármacos a códigos ATC...
2025-11-19 19:25:27,310 [INFO] - COLUMNAS DEL DF:['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:25:27,317 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 19:25:27,317 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 19:25:27,326 [INFO] - Encoders ajustados correctamente.
2025-11-19 19:25:27,373 [INFO] - Transformación completada para 10524 filas.
2025-11-19 19:25:27,393 [INFO] - Transformación completada para 2632 filas.
2025-11-19 19:25:27,393 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 19:25:27,393 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 19:25:27,399 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 268, in __init__
    self.tensors[col] = torch.from_numpy(col_values).long()
TypeError: can't convert np.ndarray of type numpy.object_. The only supported types are: float64, float32, float16, complex64, complex128, int64, int32, int16, int8, uint64, uint32, uint16, uint8, and bool.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 154, in train_pipeline
    train_dataset = PGenDataset(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\data.py", line 270, in __init__
    raise TypeError(
TypeError: Error al crear tensor para la columna 'atc'. Verifica que no contenga tipos mixtos.
2025-11-19 19:37:21,777 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 19:37:21,849 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 19:37:21,939 [INFO] - Nombres de entidades limpiados.
2025-11-19 19:37:21,982 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 19:37:23,195 [INFO] - 
Tokens sin asignar: 258

2025-11-19 19:37:23,227 [INFO] - Añadiendo 'atc' a cols_to_process para codificación.
2025-11-19 19:37:23,250 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 19:37:23,250 [INFO] - Columnas del DF: ['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:37:23,250 [INFO] - Semilla utilizada: 711
2025-11-19 19:37:23,251 [INFO] - Mapeando nombres de fármacos a códigos ATC...
2025-11-19 19:37:23,251 [INFO] - COLUMNAS DEL DF:['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:37:23,261 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 19:37:23,261 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 19:37:23,275 [INFO] - Encoders ajustados correctamente.
2025-11-19 19:37:23,401 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 19:37:23,402 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 19:37:23,438 [INFO] - DeepFM_PGenModel initialized with 1 output heads
2025-11-19 19:37:24,807 [INFO] - Model moved to device: cuda
2025-11-19 19:37:24,807 [INFO] - Mixed precision training (AMP) enabled for faster GPU computation
2025-11-19 19:37:28,379 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 238, in train_pipeline
    best_loss, best_accuracy_list, avg_per_task_losses = train_model( # type: ignore
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\train.py", line 247, in train_model
    outputs = model(**features)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
TypeError: DeepFM_PGenModel.forward() got an unexpected keyword argument 'atc'
2025-11-19 19:42:51,757 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 19:42:51,826 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 19:42:51,902 [INFO] - Nombres de entidades limpiados.
2025-11-19 19:42:51,945 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 19:42:53,059 [INFO] - 
Tokens sin asignar: 258

2025-11-19 19:42:53,087 [INFO] - Añadiendo 'atc' a cols_to_process para codificación.
2025-11-19 19:42:53,107 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 19:42:53,107 [INFO] - Columnas del DF: ['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:42:53,107 [INFO] - Semilla utilizada: 711
2025-11-19 19:42:53,107 [INFO] - Mapeando nombres de fármacos a códigos ATC...
2025-11-19 19:42:53,107 [INFO] - COLUMNAS DEL DF:['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:42:53,114 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 19:42:53,115 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 19:42:53,128 [INFO] - Encoders ajustados correctamente.
2025-11-19 19:42:53,253 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 19:42:53,254 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 19:42:53,288 [INFO] - DeepFM_PGenModel initialized with 1 output heads
2025-11-19 19:42:54,528 [INFO] - Model moved to device: cuda
2025-11-19 19:42:54,528 [INFO] - Mixed precision training (AMP) enabled for faster GPU computation
2025-11-19 19:42:58,090 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 383, in <module>
    main()
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 380, in main
    cli_menu(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 178, in cli_menu
    train_choice(model_name)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 208, in train_choice
    train_pipeline(
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\pipeline.py", line 238, in train_pipeline
    best_loss, best_accuracy_list, avg_per_task_losses = train_model( # type: ignore
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\src\train.py", line 247, in train_model
    outputs = model(**features)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "C:\Users\rukia\Documents\Master\Pharmagen\.env_pgen\lib\site-packages\torch\nn\modules\module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
TypeError: DeepFM_PGenModel.forward() missing 1 required positional argument: 'x_dict'
2025-11-19 19:44:35,028 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 19:44:35,091 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 19:44:35,167 [INFO] - Nombres de entidades limpiados.
2025-11-19 19:44:35,205 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 19:44:36,327 [INFO] - 
Tokens sin asignar: 258

2025-11-19 19:44:36,353 [INFO] - Añadiendo 'atc' a cols_to_process para codificación.
2025-11-19 19:44:36,373 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 19:44:36,373 [INFO] - Columnas del DF: ['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:44:36,373 [INFO] - Semilla utilizada: 711
2025-11-19 19:44:36,373 [INFO] - Mapeando nombres de fármacos a códigos ATC...
2025-11-19 19:44:36,374 [INFO] - COLUMNAS DEL DF:['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:44:36,383 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 19:44:36,384 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 19:44:36,397 [INFO] - Encoders ajustados correctamente.
2025-11-19 19:44:36,511 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 19:44:36,511 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 19:44:36,543 [INFO] - DeepFM_PGenModel initialized with 1 output heads
2025-11-19 19:44:37,753 [INFO] - Model moved to device: cuda
2025-11-19 19:44:37,754 [INFO] - Mixed precision training (AMP) enabled for faster GPU computation
2025-11-19 19:44:47,638 [INFO] - Model weights saved: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\models\pmodel_Features-Phenotype.pth
2025-11-19 19:44:47,649 [INFO] - Report saved: C:\Users\rukia\Documents\Master\Pharmagen\reports\report_Features-Phenotype_0.39757.txt
2025-11-19 19:49:59,231 [INFO] - Cargando datos desde C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\train_data\final_test_genalle.tsv...
2025-11-19 19:49:59,295 [INFO] - Limpiando nombres de entidades (reemplazando espacios con '_')...
2025-11-19 19:49:59,373 [INFO] - Nombres de entidades limpiados.
2025-11-19 19:49:59,412 [INFO] - Columna 'stratify_col' creada para estratificación a partir de ['Phenotype_outcome'].
2025-11-19 19:50:00,625 [INFO] - 
Tokens sin asignar: 258

2025-11-19 19:50:00,657 [INFO] - Añadiendo 'atc' a cols_to_process para codificación.
2025-11-19 19:50:00,677 [INFO] - Datos cargados y limpios. Total de filas: 13156
2025-11-19 19:50:00,677 [INFO] - Columnas del DF: ['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:50:00,677 [INFO] - Semilla utilizada: 711
2025-11-19 19:50:00,677 [INFO] - Mapeando nombres de fármacos a códigos ATC...
2025-11-19 19:50:00,677 [INFO] - COLUMNAS DEL DF:['drug', 'gene', 'allele', 'phenotype_outcome', 'effect_direction', 'effect_type', 'genalle', 'stratify_col', 'atc']
2025-11-19 19:50:00,689 [INFO] - División estratificada completada. Train: 10524, Val: 2632
2025-11-19 19:50:00,689 [INFO] - Ajustando codificadores con datos de entrenamiento...
2025-11-19 19:50:00,703 [INFO] - Encoders ajustados correctamente.
2025-11-19 19:50:00,826 [INFO] - Pre-procesamiento de datos completado.
2025-11-19 19:50:00,827 [INFO] - 
Iniciando creación de DataLoaders...
2025-11-19 19:50:00,866 [INFO] - DeepFM_PGenModel initialized with 1 output heads
2025-11-19 19:50:02,157 [INFO] - Model moved to device: cuda
2025-11-19 19:50:02,157 [INFO] - Mixed precision training (AMP) enabled for faster GPU computation
2025-11-19 19:50:10,180 [INFO] - Model weights saved: C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\models\pmodel_Features-Phenotype.pth
2025-11-19 19:50:10,197 [INFO] - Report saved: C:\Users\rukia\Documents\Master\Pharmagen\reports\report_Features-Phenotype_0.39757.txt
2025-11-20 03:03:08,512 [CRITICAL] - Excepción no controlada:
Traceback (most recent call last):
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\rukia\AppData\Local\Programs\Python\Python310\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 384, in <module>
    model_name = select_model(model_options, "Selecciona el modelo con el que vas a trabajar: ")
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 381, in main
    def main():
  File "C:\Users\rukia\Documents\Master\Pharmagen\pgen_model\__main__.py", line 172, in cli_menu
    choice = input(f"Selecciona opción (1-5): ")
ValueError: invalid literal for int() with base 10: ''
